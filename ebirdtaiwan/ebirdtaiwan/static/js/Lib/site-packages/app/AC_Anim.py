from browser import window, document, html
import random

run = None
peoples = []
towns = [] 
upload_time = []
random_delay = []

thumbnail = [random.randint(1,50) for i in range(20)]
random_delay.append(random.randint(2,3))
for i in range(14):
    random_delay.append(random_delay[-1]+random.randint(2,3))


def SetupGVar(p, t, u):
    global peoples
    global towns
    global upload_time

    peoples = p
    towns = t
    upload_time = u

def animloop(t):
    global run
    run = window.requestAnimationFrame(animloop)
    render()

def cancel_anim():
    global run
    window.cancelAnimationFrame(run)
    run = None
    print('anim is stopped!')

dt = 0 # delta time 60fps

def render():
    global dt
    global ci


    if dt == 60*random_delay[ci]:
        moving_cards()

    if ci == 14:
        cancel_anim()
        return

    if dt == 60*random_delay[ci] + 60:
        ci += 1
        update_cards()
    
    dt+=1

def wait():
    print('id not not found, wait 1s')

def init_cards(): 
    for i in range(7):
        card = html.DIV(Class='ac_card')
        card<=html.IMG(src=f'/static/img/fall/random_thumbnails/{thumbnail[i]}.png', Class='ac_card_thumbnail')
        cc = html.DIV(Class='ac_card_content')
        cc<=html.P(peoples[i])
        cc<=html.P(f'在 {towns[i]} 上傳')
        card<=cc
        card<=html.DIV(upload_time[i], Class='ac_card_time')
        document['ac_cards']<=card
    


def moving_cards(): 
    for card in document['ac_cards'].children:
        card.style = {'transform':'translateY(-12vh)','transition': 'transform 1s ease-in-out'}

ci = 0 # card index

def update_cards():
    if ci + 6 >= 20:
        print('stop update')
        return 
    for i, card in enumerate(document['ac_cards'].children):
        card.children[0].src = f'/static/img/fall/random_thumbnails/{thumbnail[ci + i]}.png'
        cc = html.DIV(Class='ac_card_content')
        cc<=html.P(peoples[ci+i])
        cc<=html.P(f'在 {towns[ci+i]} 上傳')
        card.replaceChild(cc, card.children[1])
        card.children[2].text = upload_time[ci+i]
        card.style = {'transition':'none','transform':'none'}    

def show_no_data():
    card = html.DIV(Class='ac_card')
    card<=html.IMG(src=f'/static/img/fall/random_thumbnails/{random.randint(1,50)}.png', Class='ac_card_thumbnail')
    card<=html.DIV('尚未有任何資料',Class='ac_card_content')    
    document['ac_cards']<=card
    document['ac_cards']<=card
