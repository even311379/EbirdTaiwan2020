from browser import document, html, window, timer
import browser
import time


anim_region = document["anim_region"]
sentence0 = html.DIV()
sentence1 = html.DIV()
sentence2 = html.DIV()


T0 = '202020202020'
T1 = 'EBIRD TAIWAN'
T2 = 'FALL CHALLENGE'

string_seq = list(' ABCDEFGHIJKLMNOPQRSTUVWXYZ')
num_seq = list('012')
T0_delays = [0]
for s in T0:
    T0_delays.append(num_seq.index(s)+T0_delays[-1])
T1_delays = [0]
for s in T1:
    T1_delays.append(string_seq.index(s)+T1_delays[-1])
T2_delays = [0]
for s in T2:
    T2_delays.append(string_seq.index(s)+T2_delays[-1])


for i in range(24):    
    sentence0 <= html.DIV(list('20')[i%2], Class = 'anim_letter')
    sentence1 <= html.DIV(list('20')[i%2], Class = 'anim_letter')
    sentence2 <= html.DIV(list('20')[i%2], Class = 'anim_letter')

anim_region<=sentence0
anim_region<=sentence1
anim_region<=sentence2


def change_text():
    pass

dt = 0
run = None
ch = 0
'''
unit of dt is fps (it is about 60 fps)
'''
def render():
    global dt
    global ch
    dt += 1
    if dt % 30 == 0:
        for e in document.select('div.anim_letter'):
            e.style.transition='transform 0.5s ease-out'
            e.style.transform='translateY(-30px)'

        # [e.style.transition='transform 0.5s ease-out' for e in document['anim_letter']]
        # [e.style.transform='translateY(-30px)' for e in document['anim_letter']]
        # sentence0.select('div')[0].transition='transform 0.5s ease-out'
        # sentence0.select('div')[0].style.transform='translateY(-30px)'

    if dt % 30 == 28:
        for e in document.select('div.anim_letter'):
            e.style.transform='translateY(0px)'
            e.style.transition='none'
            e.text = list('20')[ch%2]
        ch += 1
        print(ch)
        # [e.style.transform='translateY(0px)' for e in document['anim_letter']]
        # [e.style.transition='none' for e in document['anim_letter']]
        # sentence0.select('div')[0].style.transform='translateY(0px)'
        # sentence0.select('div')[0].style.transition='none'
    

def animloop(t):
    global run
    run = window.requestAnimationFrame(animloop)
    render()

def cancel_anim():
    global run
    window.cancelAnimationFrame(run)
    run = None
    for e in document.select('div.anim_letter'):
        e.style.transform='translateY(0px)'
    print('anim_stopped')
'''
unit of timer is 1 ms (1000 = 1s)
'''
def start_anim(event):
    animloop(1)
    timer.set_timeout(cancel_anim, 10000)
    

# document["button15"].bind("click", change)

# document['button15'].click()

# def test2(ev):
#     counter = timer.set_timeout(test, 500)
#     print(counter)
    

document<=html.DIV(id='hidden_trigger')
document['hidden_trigger'].bind('click', start_anim)
document['hidden_trigger'].click()
'''


print('????')

def test():
    start_time = time.time()
    r = True
    s1 = True
    while r:
        if time.time() - start_time >= 3:
            if s1:
                sentence0.select('div')[0].style.transform='translateY(-100px)'
                print('up')
                s1 = False
        if time.time() - start_time >= 6:
            sentence0.select('div')[0].style.transform='translateY(0px)'
            print('dwon')
            r = False

    print(123456)

    # global counter
    # while counter < 6000:
    #     if counter == 1000:
    #         print('up')
    #     if counter == 3000:
    #         sentence0.select('div')[0].style.transform='translateY(0px)'
    #         print('down')        



# sentence0[0].attrs['style']={'transform':'translateY(-300px)'}
# sentence0.select('div')[0].style.transform='translateY(-100px)'

for i in range(30):
    print('Are you alright?')

'''